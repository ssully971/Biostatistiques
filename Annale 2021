<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PASS UE2 - Annale 2021 (Version Finale 2.3)</title>
    <style>
        /* --- THEME SOMBRE PAR D√âFAUT (ULTRA DARK) --- */
        :root {
            --primary: #3b82f6;
            --primary-dark: #60a5fa;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            
            /* Couleurs fixes pour le mode sombre */
            --background: #000000;       /* Noir Pur */
            --card-bg: #121212;          /* Gris Anthracite */
            --item-bg: #1a1a1a;          /* Gris sombre */
            --text-main: #ffffff;        /* Blanc Pur */
            --text-muted: #a3a3a3;       /* Gris clair */
            --border: #333333;           /* Bordure subtile */
            --shadow: 0 4px 20px rgba(255,255,255,0.05);
        }

        [data-theme="light"] {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --background: #f8fafc;
            --card-bg: #ffffff;
            --item-bg: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        * { box-sizing: border-box; transition: background-color 0.3s, color 0.2s; }
        body { margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--background); color: var(--text-main); height: 100vh; overflow: hidden; }

        /* --- LAYOUT --- */
        #app { display: flex; flex-direction: column; height: 100%; }
        
        header { padding: 1rem 2rem; background: var(--card-bg); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .header-title h1 { margin: 0; font-size: 1.2rem; }
        .header-controls { display: flex; gap: 1rem; align-items: center; }
        .timer { font-family: monospace; font-size: 1.2rem; font-weight: bold; padding: 0.25rem 0.75rem; background: var(--background); border-radius: 6px; border: 1px solid var(--border); color: var(--text-main); }
        .timer.paused { opacity: 0.5; }

        main { flex: 1; position: relative; overflow: hidden; display: flex; }
        
        #nav-panel {
            position: absolute; left: -320px; top: 0; bottom: 0; width: 300px;
            background: var(--card-bg); border-right: 1px solid var(--border);
            z-index: 20; transition: transform 0.3s ease; display: flex; flex-direction: column;
            box-shadow: 4px 0 15px rgba(0,0,0,0.5);
        }
        #nav-panel.open { transform: translateX(320px); }
        .nav-grid { padding: 1rem; overflow-y: auto; display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; }
        .nav-btn { aspect-ratio: 1; border: 1px solid var(--border); background: var(--item-bg); border-radius: 4px; cursor: pointer; font-size: 0.9rem; color: var(--text-main); }
        .nav-btn.success { background: var(--success); color: white; border-color: var(--success); }
        .nav-btn.warning { background: var(--warning); color: white; border-color: var(--warning); }
        .nav-btn.danger { background: var(--danger); color: white; border-color: var(--danger); }
        .nav-btn.current { border: 2px solid var(--primary); }

        #question-container { flex: 1; overflow-y: auto; padding: 2rem; max-width: 900px; margin: 0 auto; width: 100%; }
        .question-card { background: var(--card-bg); padding: 2rem; border-radius: 12px; box-shadow: var(--shadow); border: 1px solid var(--border); }
        .q-header { display: flex; justify-content: space-between; margin-bottom: 1.5rem; color: var(--text-muted); font-weight: 600; }
        .q-text { font-size: 1.25rem; margin-bottom: 2rem; line-height: 1.5; color: var(--text-main); }
        
        .item-row { display: flex; align-items: flex-start; padding: 1rem; margin-bottom: 0.75rem; border: 1px solid var(--border); background: var(--item-bg); border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .item-row:hover { border-color: var(--primary); transform: translateX(5px); }
        .item-row.selected { border-color: var(--primary); background: rgba(59, 130, 246, 0.15); }
        .checkbox { width: 24px; height: 24px; border: 2px solid var(--text-muted); border-radius: 4px; margin-right: 1rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0; color: var(--text-main); }
        .item-row.selected .checkbox { background: var(--primary); border-color: var(--primary); color: white; }
        .item-letter { font-weight: bold; margin-right: 0.5rem; color: var(--primary); }

        footer { padding: 1rem 2rem; background: var(--card-bg); border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 1rem; }
        button { padding: 0.75rem 1.5rem; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; font-size: 1rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { filter: brightness(1.1); }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-muted); }
        .btn-outline:hover { border-color: var(--text-main); color: var(--text-main); }

        /* FEEDBACK OVERLAY */
        #feedback-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95);
            z-index: 50; display: none; flex-direction: column; backdrop-filter: blur(5px);
        }
        #feedback-overlay.active { display: flex; }
        .feedback-summary { height: 30%; background: var(--card-bg); padding: 2rem; display: flex; flex-direction: column; justify-content: center; align-items: center; border-bottom: 1px solid var(--border); text-align: center; }
        .feedback-details { height: 70%; background: var(--background); overflow-y: auto; padding: 2rem; }
        .detail-card { max-width: 800px; margin: 0 auto 1rem; background: var(--card-bg); padding: 1.5rem; border-radius: 8px; border-left: 5px solid transparent; box-shadow: var(--shadow); border: 1px solid var(--border); color: var(--text-main); }
        .detail-card.correct { border-left-color: var(--success); }
        .detail-card.error { border-left-color: var(--danger); }

        /* --- SUMMARY SCREEN STYLES (NEW) --- */
        #summary-screen { 
            display: none; 
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            padding: 2rem; overflow-y: auto; 
            background: var(--background); 
            color: var(--text-main);
            z-index: 100;
        }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: var(--card-bg); padding: 1.5rem; border-radius: 8px; text-align: center; box-shadow: var(--shadow); border: 1px solid var(--border); color: var(--text-main); }
        .stat-val { font-size: 2rem; font-weight: bold; color: var(--primary); }
        
        /* Summary Question Block */
        .summary-block {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }
        .summary-block h3 { margin-top: 0; display: flex; justify-content: space-between; color: var(--primary); border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; }
        .summary-block .score-tag { font-size: 0.9em; padding: 2px 8px; border-radius: 4px; color: white; }
        
        .summary-item-row {
            display: flex;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            align-items: flex-start;
        }
        .summary-item-status { width: 25px; font-size: 1.2rem; flex-shrink: 0; }
        .summary-item-text { flex: 1; color: var(--text-main); }
        .summary-item-expl { color: var(--text-muted); font-size: 0.9rem; margin-top: 0.2rem; font-style: italic; }
        .user-action { font-size: 0.8rem; text-transform: uppercase; font-weight: bold; margin-left: 0.5rem; padding: 2px 4px; border-radius: 3px; }
        .ua-checked { background: rgba(59, 130, 246, 0.2); color: var(--primary-dark); }
        
        .buttons-row { display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; margin-bottom: 4rem; }

        /* Utils */
        .hidden { display: none !important; }
        #home-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 2rem; background: var(--background); color: var(--text-main); }
        .hero-title { font-size: 2.5rem; margin-bottom: 1rem; color: var(--primary); }
    </style>
</head>
<body data-theme="dark">

<div id="app">
    <div id="home-screen">
        <h1 class="hero-title">PASS UE2 - Annale 2021</h1>
        <p style="font-size: 1.2rem; color: var(--text-muted); margin-bottom: 2rem;">Biostatistiques & √âpid√©miologie<br>20 Questions QCM ‚Ä¢ Notation Stricte</p>
        <div style="background: var(--card-bg); padding: 2rem; border-radius: 12px; box-shadow: var(--shadow); max-width: 500px; border: 1px solid var(--border);">
            <p><strong>R√®gles de notation :</strong></p>
            <ul style="text-align: left; margin-bottom: 2rem; color: var(--text-main);">
                <li>‚úÖ 0 erreur = <strong>1 Point</strong></li>
                <li>‚ö†Ô∏è 1 erreur = <strong>0.5 Point</strong></li>
                <li>‚ùå 2+ erreurs = <strong>0 Point</strong></li>
            </ul>
            <button class="btn-primary" onclick="startQuiz()" style="width: 100%; font-size: 1.2rem;">Commencer l'entra√Ænement</button>
        </div>
    </div>

    <div id="quiz-interface" class="hidden" style="height: 100%; display: flex; flex-direction: column;">
        <header>
            <div class="header-controls">
                <button class="btn-outline" onclick="toggleNav()" style="padding: 0.5rem;">‚ò∞ Questions</button>
                <div class="header-title">
                    <h1 id="header-q-num" style="color: var(--text-main);">Question 1/20</h1>
                </div>
            </div>
            <div class="header-controls">
                <div id="timer" class="timer">00:00</div>
                <button class="btn-outline" onclick="toggleTheme()" style="padding: 0.5rem;">‚òÄÔ∏è/üåë</button>
            </div>
        </header>

        <main>
            <div id="nav-panel">
                <div style="padding: 1rem; border-bottom: 1px solid var(--border); color: var(--text-main);">
                    <strong>Navigation</strong>
                </div>
                <div class="nav-grid" id="nav-grid"></div>
            </div>

            <div id="question-container"></div>
        </main>

        <footer>
            <button class="btn-outline" onclick="flagQuestion()">‚≠ê Flaguer</button>
            <button class="btn-primary" onclick="validateAnswer()">Valider la r√©ponse</button>
        </footer>
    </div>

    <div id="feedback-overlay">
        <div class="feedback-summary" id="feedback-summary"></div>
        <div class="feedback-details" id="feedback-details"></div>
        <div id="feedback-action-area" style="background: var(--card-bg); padding: 1.5rem; border-top: 1px solid var(--border); text-align: center;"></div>
    </div>

    <div id="summary-screen">
        <div style="max-width: 900px; margin: 0 auto;">
            <h1 style="text-align: center; margin-bottom: 2rem; color: var(--text-main);">R√©sultats D√©taill√©s</h1>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-val" id="final-score">--/20</div>
                    <div style="color: var(--text-muted);">Note Finale</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val" id="final-percent">--%</div>
                    <div style="color: var(--text-muted);">R√©ussite</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val" id="final-time">--:--</div>
                    <div style="color: var(--text-muted);">Temps Total</div>
                </div>
            </div>

            <div id="summary-details">
                </div>
            
            <div class="buttons-row">
                <button class="btn-outline" onclick="copyCorrection()" style="border-color: var(--primary); color: var(--primary);">üìã Copier le rapport complet</button>
                <button class="btn-primary" onclick="location.reload()">üîÑ Recommencer</button>
            </div>
        </div>
    </div>
</div>

<script>
// --- DATA IMPORT ---
const quizData = {
    title: "UE2 Annale 2020-2021",
    questions: [
        {
            id: 1,
            text: "Les classes d'√¢ge 0-10, 11-20, 21-40, 41-60, 61-80 sont :",
            items: [
                { id: "A", text: "Une variable dichotomique", correct: false, explication: "Faux. Une variable dichotomique n'a que 2 cat√©gories (ex: Oui/Non, M/F)." },
                { id: "B", text: "Une variable ordinale", correct: true, explication: "Vrai. Les classes sont ordonn√©es (de la plus jeune √† la plus √¢g√©e)." },
                { id: "C", text: "Une variable quantitative discr√®te", correct: false, explication: "Faux. C'est une variable qualitative ordinale issue d'une discr√©tisation." },
                { id: "D", text: "Contiennent plus d'information que la variable quantitative continue √¢ge", correct: false, explication: "Faux. Elles contiennent MOINS d'information car on perd la valeur exacte de l'√¢ge." },
                { id: "E", text: "Sont parfois plus intelligibles que la variable continue pour l'√©tude de certains probl√®mes de sant√©", correct: true, explication: "Vrai. Le regroupement permet de voir des tendances par tranches de vie (enfance, adolescence, etc.)." }
            ]
        },
        {
            id: 2,
            text: "Les statistiques descriptives d'une variable quantitative comportent :",
            items: [
                { id: "A", text: "le risque alpha", correct: false, explication: "Faux. Le risque alpha concerne les tests d'hypoth√®se (statistiques inductives)." },
                { id: "B", text: "une mesure de position seulement", correct: false, explication: "Faux. Il faut aussi une mesure de dispersion." },
                { id: "C", text: "l'effectif", correct: true, explication: "Vrai. L'effectif (n) fait partie de la description de base." },
                { id: "D", text: "une mesure de position et une mesure de dispersion", correct: true, explication: "Vrai. On associe toujours position (ex: moyenne) et dispersion (ex: √©cart-type)." },
                { id: "E", text: "aucune des r√©ponses ci-dessus", correct: false, explication: "Faux, voir C et D." }
            ]
        },
        {
            id: 3,
            text: "La description d'une variable qualitative comporte :",
            items: [
                { id: "A", text: "une mesure de position et une mesure de dispersion", correct: false, explication: "Faux. C'est pour les variables quantitatives." },
                { id: "B", text: "le risque alpha", correct: false, explication: "Faux. Concerne les tests d'hypoth√®se." },
                { id: "C", text: "la probabilit√© p de rejeter √† tort l'hypoth√®se nulle", correct: false, explication: "Faux. Concerne les tests inductifs." },
                { id: "D", text: "l'effectif", correct: true, explication: "Vrai. On d√©crit par le nombre d'observations (n)." },
                { id: "E", text: "le pourcentage", correct: true, explication: "Vrai. Ou fr√©quence, pour chaque cat√©gorie." }
            ]
        },
        {
            id: 4,
            text: "Parmi les mesures suivantes sont des mesures de position:",
            items: [
                { id: "A", text: "la m√©diane", correct: true, explication: "Vrai. C'est une mesure de position centrale (50%)." },
                { id: "B", text: "l'√©cart type", correct: false, explication: "Faux. C'est une mesure de dispersion." },
                { id: "C", text: "la moyenne", correct: true, explication: "Vrai. Mesure de position centrale." },
                { id: "D", text: "le risque alpha", correct: false, explication: "Faux. Ni position, ni dispersion." },
                { id: "E", text: "le 9√®me d√©cile", correct: true, explication: "Vrai. C'est une mesure de position (non centrale)." }
            ]
        },
        {
            id: 5,
            text: "Parmi les mesures suivantes sont des mesures de dispersion:",
            items: [
                { id: "A", text: "le 3√®me quartile", correct: false, explication: "Faux. C'est une mesure de position (Q3)." },
                { id: "B", text: "l'√©cart type", correct: true, explication: "Vrai. Racine carr√©e de la variance." },
                { id: "C", text: "l'intervalle interquartile", correct: true, explication: "Vrai. Diff√©rence entre Q3 et Q1." },
                { id: "D", text: "l'√©tendue", correct: true, explication: "Vrai. Diff√©rence entre Max et Min." },
                { id: "E", text: "la variance", correct: true, explication: "Vrai. Moyenne des carr√©s des √©carts √† la moyenne." }
            ]
        },
        {
            id: 6,
            text: "Les m√©thodes d'√©chantillonnage non probabiliste comportent :",
            items: [
                { id: "A", text: "la m√©thode des quotas", correct: true, explication: "Vrai. M√©thode empirique non probabiliste." },
                { id: "B", text: "le sondage syst√©matique", correct: false, explication: "Faux. C'est une m√©thode probabiliste (al√©atoire)." },
                { id: "C", text: "la m√©thode de la boule de neige", correct: true, explication: "Vrai. On recrute les connaissances des sujets (non probabiliste)." },
                { id: "D", text: "le sondage multi√©tapes", correct: false, explication: "Faux. C'est probabiliste (tirages successifs)." },
                { id: "E", text: "la m√©thode des unit√©s types", correct: true, explication: "Vrai. Choix raisonn√© d'unit√©s 'moyennes' (non probabiliste)." }
            ]
        },
        {
            id: 7,
            text: "La moyenne de poids dans la population estim√©e √† partir d'un √©chantillon est de 68 KG avec un intervalle de confiance √† 95% de 45 √† 86 KG. Cela signifie que:",
            items: [
                { id: "A", text: "il est impossible de quantifier le risque de se tromper", correct: false, explication: "Faux. Le risque est quantifi√© par alpha (5% ici)." },
                { id: "B", text: "on est s√ªr que la vraie valeur se trouve entre 45 et 86 KG", correct: false, explication: "Faux. On est jamais s√ªr √† 100% en statistiques." },
                { id: "C", text: "il y a 95% de chances que la vraie valeur se trouve entre 45 et 86 KG", correct: true, explication: "Vrai. C'est la d√©finition de l'IC √† 95%." },
                { id: "D", text: "il y a 5% de chances que la vraie valeur se trouve en dessous de 45 KG ou au dessus de 86KG", correct: true, explication: "Vrai. C'est le compl√©mentaire (risque alpha = 5%)." },
                { id: "E", text: "il y a 5% de chances que la vraie valeur se trouve entre 45 et 86 KG", correct: false, explication: "Faux. C'est 95%." }
            ]
        },
        {
            id: 8,
            text: "La moyenne d'√¢ge dans la population estim√©e √† partir d'un √©chantillon repr√©sentatif est de 24 ans avec un intervalle de confiance √† 95% de 15 √† 33 ans. Si l'on reprend un autre √©chantillon al√©atoire plus grand:",
            items: [
                { id: "A", text: "la pr√©cision de l'estimation de la moyenne d'√¢ge sera meilleure", correct: true, explication: "Vrai. Plus n augmente, plus la pr√©cision augmente." },
                { id: "B", text: "l'intervalle de confiance √† 95% sera plus √©troit", correct: true, explication: "Vrai. La largeur de l'IC diminue quand n augmente (divis√© par racine de n)." },
                { id: "C", text: "l'intervalle de confiance √† 95% sera le m√™me", correct: false, explication: "Faux. Il sera plus √©troit." },
                { id: "D", text: "l'intervalle de confiance √† 95% sera plus √©tendu", correct: false, explication: "Faux. Il sera plus √©troit." },
                { id: "E", text: "la pr√©cision de l'estimation de la moyenne d'√¢ge sera identique", correct: false, explication: "Faux. Elle sera meilleure." }
            ]
        },
        {
            id: 9,
            text: "L'ARS cherche √† avoir des chiffres sur les handicaps... On √©tudie les donn√©es d'un registre exhaustif qui recueille les donn√©es sur tous les enfants. La pr√©valence est 1.4/1000.",
            items: [
                { id: "A", text: "la pr√©cision de l'estimation sera mauvaise", correct: false, explication: "Faux. Il n'y a pas d'estimation car le registre est exhaustif (c'est un recensement)." },
                { id: "B", text: "l'intervalle de confiance √† 95% sera √©troit", correct: false, explication: "Faux. On ne calcule pas d'IC sur une population exhaustive." },
                { id: "C", text: "l'intervalle de confiance √† 95% sera large", correct: false, explication: "Faux. Pas d'IC calculable." },
                { id: "D", text: "il s'agit de statistiques inductives", correct: false, explication: "Faux. C'est de la statistique descriptive pure (recensement)." },
                { id: "E", text: "on conna√Æt le chiffre exact, il n'y a pas lieu de donner un intervalle de confiance", correct: true, explication: "Vrai. Puisque nous avons les donn√©es de TOUTE la population (exhaustif)." }
            ]
        },
        {
            id: 10,
            text: "Concernant les tests d'hypoth√®se :",
            items: [
                { id: "A", text: "l'hypoth√®se nulle et l'hypoth√®se alternative sont mutuellement exclusives", correct: true, explication: "Vrai. Soit H0 est vraie, soit H1 est vraie." },
                { id: "B", text: "si la caract√©ristique observ√©e fait partie de l'intervalle de pari l'hypoth√®se nulle n'a que a chances sur 100 d'√™tre vraie", correct: false, explication: "Faux. Si on est dans l'intervalle de pari, H0 est consid√©r√©e comme plausible (100-alpha %)." },
                { id: "C", text: "l'hypoth√®se alternative repr√©sente la situation ou les deux groupes compar√©s sont identiques", correct: false, explication: "Faux. √áa c'est la d√©finition de H0." },
                { id: "D", text: "sont bas√©s sur un raisonnement par l'absurde", correct: true, explication: "Vrai. On suppose H0 vraie, et on regarde si les donn√©es sont compatibles. Sinon on rejette." },
                { id: "E", text: "l'hypoth√®se nulle repr√©sente la situation ou les deux groupes compar√©s sont identiques", correct: true, explication: "Vrai. H0 = Pas de diff√©rence." }
            ]
        },
        {
            id: 11,
            text: "Lors d'un test d'hypoth√®se, une probabilit√© p < 0,05 signifie:",
            items: [
                { id: "A", text: "qu'il n'y a pas de diff√©rence significative entre deux groupes compar√©s", correct: false, explication: "Faux. Si p < 0.05, la diff√©rence EST significative." },
                { id: "B", text: "qu'il existe une diff√©rence significative entre les deux groupes compar√©s", correct: true, explication: "Vrai. On rejette H0." },
                { id: "C", text: "que l'on a moins de 5 chances sur 100 de se tromper en disant que les groupes sont diff√©rents", correct: true, explication: "Vrai. C'est la d√©finition du risque alpha a posteriori." },
                { id: "D", text: "que l'on peut rejeter l'hypoth√®se nulle", correct: true, explication: "Vrai. Car p < alpha." },
                { id: "E", text: "que l'on peut choisir l'hypoth√®se alternative avec moins de 5% de risque d'erreur", correct: true, explication: "Vrai. Similaire √† l'item C." }
            ]
        },
        {
            id: 12,
            text: "Concernant les tests d'hypoth√®se, le risque Œ± (alpha) :",
            items: [
                { id: "A", text: "marque le manque de puissance", correct: false, explication: "Faux. Le manque de puissance est li√© au risque B√™ta." },
                { id: "B", text: "correspond au risque de conclure qu'il n'y a pas de diff√©rence... alors qu'en r√©alit√© il y en a une", correct: false, explication: "Faux. √áa c'est le risque B√™ta (faux n√©gatif)." },
                { id: "C", text: "correspond au risque de conclure qu'il y a une diff√©rence... alors qu'en r√©alit√© il n'y en a pas", correct: true, explication: "Vrai. C'est le risque de 1√®re esp√®ce (faux positif)." },
                { id: "D", text: "correspond au risque d'accepter √† tort l'hypoth√®se nulle", correct: false, explication: "Faux. √áa c'est le risque B√™ta." },
                { id: "E", text: "correspond au risque d'accepter √† tort l'hypoth√®se alternative", correct: true, explication: "Vrai. Accepter H1 √† tort = Rejeter H0 √† tort." }
            ]
        },
        {
            id: 13,
            text: "On cherche √† savoir si la proportion de fumeurs est plus √©lev√©e chez les hommes que chez les femmes. Pour faire une comparaison statistique de 2 variables qualitatives:",
            items: [
                { id: "A", text: "on teste l'hypoth√®se nulle ¬´ il n'y a aucune diff√©rence de pourcentage entre les 2 groupes ¬ª", correct: true, explication: "Vrai. H0 est toujours l'√©galit√© des proportions." },
                { id: "B", text: "on utilise un test du Khi2", correct: true, explication: "Vrai. Le Chi-2 compare des distributions de variables qualitatives." },
                { id: "C", text: "on utilise un test de Mann Whitney", correct: false, explication: "Faux. Mann Whitney est pour les variables quantitatives (rangs)." },
                { id: "D", text: "on utilise un test de Student", correct: false, explication: "Faux. Student est pour comparer des moyennes (variables quantitatives)." },
                { id: "E", text: "si le Khi2 calcul√© est > au Khi2(alpha) on rejette l'hypoth√®se nulle", correct: true, explication: "Vrai. Si la statistique observ√©e d√©passe le seuil critique, le test est significatif." }
            ]
        },
        {
            id: 14,
            text: "Pour faire une comparaison statistique de 2 moyennes :",
            items: [
                { id: "A", text: "on teste l'hypoth√®se nulle ¬´ il n'y a pas de diff√©rence de moyenne entre les 2 groupes ¬ª", correct: true, explication: "Vrai. H0 : ¬µ1 = ¬µ2." },
                { id: "B", text: "on peut utiliser un test du x2", correct: false, explication: "Faux. Chi2 est pour les variables qualitatives." },
                { id: "C", text: "on peut utiliser un test de Mann Whitney", correct: true, explication: "Vrai. C'est l'alternative non param√©trique pour comparer deux groupes (si distribution non normale)." },
                { id: "D", text: "on peut utiliser un test de Student", correct: true, explication: "Vrai. Test param√©trique de r√©f√©rence pour comparer 2 moyennes." },
                { id: "E", text: "on d√©finit le seuil de significativit√© √† post√©riori", correct: false, explication: "Faux. Le seuil alpha se fixe TOUJOURS a priori (avant l'√©tude)." }
            ]
        },
        {
            id: 15,
            text: "La randomisation permet de:",
            items: [
                { id: "A", text: "D'aveugler l'investigateur et le patient", correct: false, explication: "Faux. √áa c'est le double aveugle (masquage)." },
                { id: "B", text: "Contr√¥ler les biais d'information", correct: false, explication: "Faux. La randomisation contr√¥le les biais de s√©lection/confusion." },
                { id: "C", text: "D'avoir plus de puissance", correct: true, explication: "Vrai. En assurant la comparabilit√© des groupes, on optimise la puissance statistique." },
                { id: "D", text: "D'√©quilibrer les facteurs de confusion", correct: true, explication: "Vrai. C'est le but principal : r√©partir les facteurs connus et inconnus de mani√®re homog√®ne." },
                { id: "E", text: "D'√©viter les perdus de vue", correct: false, explication: "Faux. La randomisation n'emp√™che pas les patients de quitter l'√©tude." }
            ]
        },
        {
            id: 16,
            text: "Nous √©tudions l'association entre la consommation de soda et la survenue de caries. Pour cela, nous obtenons une valeur de P=0,06 lors d'un test du Chi¬≤.",
            items: [
                { id: "A", text: "il existe 6% de risque de se tromper si on rejette l'hypoth√®se nulle", correct: true, explication: "Vrai. C'est la d√©finition de p." },
                { id: "B", text: "l'hypoth√®se alternative ici: la proportion de personnes pr√©sentant des caries n'est pas la m√™me dans le groupe de ceux qui boivent du soda et ceux qui n'en boivent pas", correct: true, explication: "Vrai. H1 : P1 ‚â† P2." },
                { id: "C", text: "On peut se demander au vu des r√©sultats, si on ne peut pas rejeter l'hypoth√®se nulle par manque de puissance au seuil de 5%", correct: true, explication: "Vrai. p=0.06 est tr√®s proche de 0.05. Avec plus de sujets, cela aurait pu √™tre significatif." },
                { id: "D", text: "Avant de conclure, il est n√©cessaire d'√©tudier les biais potentiels survenus lors de l'√©tude", correct: true, explication: "Vrai. Toujours v√©rifier la validit√© interne avant d'interpr√©ter p." },
                { id: "E", text: "La diff√©rence n'est pas significative pour un seuil de 10%", correct: false, explication: "Faux. p=0.06 est INFERIEUR √† 0.10, donc c'est significatif au seuil de 10%." }
            ]
        },
        {
            id: 17,
            text: "Les tests non param√©triques :",
            items: [
                { id: "A", text: "comportent le test de Student", correct: false, explication: "Faux. Student est param√©trique (suppose une distribution normale)." },
                { id: "B", text: "comportent le test de Wilcoxon", correct: true, explication: "Vrai. Wilcoxon est un test de rangs non param√©trique." },
                { id: "C", text: "comportent le test de Mann Whitney", correct: true, explication: "Vrai. √âquivalent non param√©trique du test T." },
                { id: "D", text: "sont utilis√©s lorsque les √©chantillons sont petits ou lorsque la distribution n'est pas normale", correct: true, explication: "Vrai. Conditions d'application classiques." },
                { id: "E", text: "sont plus puissants que les tests parametriques", correct: false, explication: "Faux. Ils sont g√©n√©ralement MOINS puissants car ils utilisent moins d'information (les rangs au lieu des valeurs)." }
            ]
        },
        {
            id: 18,
            text: "On compare la concentration sanguine en vitamine A entre les hommes et les femmes: le test de Student r√©alis√© montre un p=0,95",
            items: [
                { id: "A", text: "la diff√©rence entre hommes et femmes n'est pas significative", correct: true, explication: "Vrai. p > 0.05 donc on ne rejette pas H0." },
                { id: "B", text: "si l'on rejette l'hypoth√®se nulle il y a un risque de se tromper de 95%", correct: true, explication: "Vrai. p repr√©sente ce risque." },
                { id: "C", text: "on ne peut rejeter l'hypoth√®se nulle", correct: true, explication: "Vrai. Car p > alpha." },
                { id: "D", text: "on rejette l'hypoth√®se nulle avec un risque de se tromper √† 5%", correct: false, explication: "Faux. On ne rejette PAS H0." },
                { id: "E", text: "si l'on accepte l'hypoth√®se alternative il y a un risque de 95% de se tromper", correct: true, explication: "Vrai. C'est une autre fa√ßon de dire l'item B (Accepter H1 = Rejeter H0)." }
            ]
        },
        {
            id: 19,
            text: "Les √©tudes de cohorte :",
            items: [
                { id: "A", text: "sont particuli√®rement int√©ressantes pour l'√©tude des maladies rares", correct: false, explication: "Faux. Pour les maladies rares, on pr√©f√®re les √©tudes Cas-T√©moins. Les cohortes sont bien pour les EXPOSITIONS rares." },
                { id: "B", text: "sont d'un niveau de preuve inf√©rieur aux essais randomis√©s contr√¥l√©s", correct: false, explication: "Faux (selon correction). Elles ont souvent un niveau de preuve tr√®s √©lev√© (juste sous les essais), mais la correction indique ici que c'est faux de les classer 'inf√©rieur' sans nuance ou consid√®re l'item comme ambigu ? Correction officielle: CDE." },
                { id: "C", text: "leur avantage est qu'elles permettent de mesurer directement la pr√©valence", correct: true, explication: "Vrai (et incidence surtout)." },
                { id: "D", text: "sont g√©n√©ralement plus fiables que les √©tudes cas t√©moin", correct: true, explication: "Vrai. Moins de biais de m√©morisation, chronologie claire." },
                { id: "E", text: "permettent d'√©tudier plusieurs maladies li√©es √† une exposition donn√©e", correct: true, explication: "Vrai. On suit des expos√©s et on voit tout ce qui leur arrive." }
            ]
        },
        {
            id: 20,
            text: "Les √©tudes cas t√©moin :",
            items: [
                { id: "A", text: "Un niveau de preuve inf√©rieur aux √©tudes transversales", correct: false, explication: "Faux. Elles sont sup√©rieures aux transversales (mais inf√©rieures aux cohortes)." },
                { id: "B", text: "Permettent d'√©tudier plusieurs maladies et une exposition", correct: false, explication: "Faux. On part d'UNE maladie (les cas) et on cherche plusieurs expositions pass√©es." },
                { id: "C", text: "Sont prospectives", correct: false, explication: "Faux. Elles sont r√©trospectives (on regarde dans le pass√©)." },
                { id: "D", text: "Sont rarement entach√©es de facteurs de confusion", correct: false, explication: "Faux. Au contraire, elles sont tr√®s sujettes aux biais (s√©lection, m√©morisation)." },
                { id: "E", text: "permettent de calculer une estimation indirecte du risque relatif", correct: true, explication: "Vrai. On calcule l'Odds Ratio (OR) qui estime le RR si la maladie est rare." }
            ]
        }
    ]
};

// --- STATE MANAGEMENT ---
let currentQIndex = 0;
let userAnswers = {}; // { qId: ['A', 'C'] }
let flaggedQuestions = new Set();
let timerInterval;
let secondsElapsed = 0;
let isTimerPaused = false;

// --- INITIALIZATION ---
function init() {
    renderNav();
}

function startQuiz() {
    document.getElementById('home-screen').classList.add('hidden');
    document.getElementById('quiz-interface').classList.remove('hidden');
    loadQuestion(0);
    startTimer();
    renderNav();
}

// --- CORE FUNCTIONS ---
function loadQuestion(index) {
    currentQIndex = index;
    const q = quizData.questions[index];
    
    // Header Info
    document.getElementById('header-q-num').innerText = `Question ${index + 1}/${quizData.questions.length}`;
    updateNavSelection();

    // Render Question
    const container = document.getElementById('question-container');
    const existingAnswers = userAnswers[q.id] || [];
    
    let html = `
        <div class="question-card">
            <div class="q-header">
                <span>UE2 BIOSTATISTIQUES</span>
                <span>${q.id}</span>
            </div>
            <div class="q-text">${q.text}</div>
            <div class="items-list">
    `;

    q.items.forEach(item => {
        const isSelected = existingAnswers.includes(item.id);
        html += `
            <div class="item-row ${isSelected ? 'selected' : ''}" onclick="toggleItem('${item.id}', this)">
                <div class="checkbox">${isSelected ? '‚úì' : ''}</div>
                <div class="item-letter">${item.id}</div>
                <div>${item.text}</div>
            </div>
        `;
    });

    html += `</div></div>`;
    container.innerHTML = html;
}

function toggleItem(itemId, element) {
    const qId = quizData.questions[currentQIndex].id;
    if (!userAnswers[qId]) userAnswers[qId] = [];
    
    const idx = userAnswers[qId].indexOf(itemId);
    if (idx === -1) {
        userAnswers[qId].push(itemId);
        element.classList.add('selected');
        element.querySelector('.checkbox').innerText = '‚úì';
    } else {
        userAnswers[qId].splice(idx, 1);
        element.classList.remove('selected');
        element.querySelector('.checkbox').innerText = '';
    }
}

function validateAnswer() {
    const q = quizData.questions[currentQIndex];
    const userAns = userAnswers[q.id] || [];
    
    // Logic: 0 errors=1pt, 1 error=0.5pt, 2+ errors=0pt
    let errors = 0;
    
    // Calculate False Positives (Coche mais faux) and False Negatives (Pas coche mais vrai)
    q.items.forEach(item => {
        const isChecked = userAns.includes(item.id);
        if (isChecked && !item.correct) errors++; // FP
        if (!isChecked && item.correct) errors++; // FN
    });

    // Score Calculation
    let score = 0;
    let scoreClass = 'danger';
    let scoreText = '0 POINT';
    
    if (errors === 0) { score = 1; scoreClass = 'success'; scoreText = '‚úÖ 1 POINT'; }
    else if (errors === 1) { score = 0.5; scoreClass = 'warning'; scoreText = '‚ö†Ô∏è 0.5 POINT'; }
    else { score = 0; scoreClass = 'danger'; scoreText = '‚ùå 0 POINT'; }

    // Save score for final summary
    q.score = score;
    q.errors = errors;

    // Show Feedback
    showFeedback(q, userAns, score, scoreText, scoreClass);
}

function showFeedback(q, userAns, score, scoreText, scoreClass) {
    pauseTimer();
    const overlay = document.getElementById('feedback-overlay');
    const summary = document.getElementById('feedback-summary');
    const details = document.getElementById('feedback-details');
    const actionArea = document.getElementById('feedback-action-area');
    
    // Top Summary
    summary.innerHTML = `
        <div class="score-badge" style="color: var(--${scoreClass})">${scoreText}</div>
        <div style="font-size: 1.2rem; margin-bottom: 1rem; color: var(--text-main);">${q.errors} erreur(s) commise(s)</div>
        <div style="color: var(--text-muted)">${score === 1 ? 'Bravo ! R√©ponse parfaite.' : (score === 0.5 ? 'Attention, presque bon !' : '√Ä revoir d\'urgence.')}</div>
    `;

    // Bottom Details
    let detailsHtml = '';
    q.items.forEach(item => {
        const isChecked = userAns.includes(item.id);
        let statusClass = '';
        let icon = '';
        let statusText = '';

        if (item.correct) {
            if (isChecked) { statusClass = 'correct'; icon = '‚úÖ'; statusText = 'Correct (Coch√©)'; }
            else { statusClass = 'error'; icon = '‚ö†Ô∏è'; statusText = 'Erreur (Oubli√©)'; }
        } else {
            if (isChecked) { statusClass = 'error'; icon = '‚ùå'; statusText = 'Erreur (Coch√© √† tort)'; }
            else { statusClass = 'correct'; icon = '‚úì'; statusText = 'Correct (Non coch√©)'; }
        }

        detailsHtml += `
            <div class="detail-card ${statusClass}">
                <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem; font-weight:bold;">
                    <span>${icon} Item ${item.id} - ${statusText}</span>
                    <span style="color: ${item.correct ? 'var(--success)' : 'var(--danger)'}">${item.correct ? 'VRAI' : 'FAUX'}</span>
                </div>
                <div style="font-style: italic; margin-bottom: 0.5rem; color: var(--text-main);">"${item.text}"</div>
                <div style="padding-top: 0.5rem; border-top: 1px dashed var(--border); color: var(--text-muted);">
                    <strong>Explication :</strong> ${item.explication}
                </div>
            </div>
        `;
    });
    details.innerHTML = detailsHtml;

    // Button Logic: Next vs Finish
    const isLastQuestion = currentQIndex === quizData.questions.length - 1;
    if (isLastQuestion) {
        actionArea.innerHTML = `<button class="btn-primary" onclick="finishQuiz()" style="font-size: 1.2rem; padding: 1rem 3rem; background-color: var(--success);">TERMINER & VOIR R√âSULTATS üèÅ</button>`;
    } else {
        actionArea.innerHTML = `<button class="btn-primary" onclick="nextQuestion()" style="font-size: 1.2rem; padding: 1rem 3rem;">Question Suivante ‚Üí</button>`;
    }

    overlay.classList.add('active');
    updateNavColor(currentQIndex, scoreClass);
}

function nextQuestion() {
    document.getElementById('feedback-overlay').classList.remove('active');
    
    resumeTimer();
    
    if (currentQIndex < quizData.questions.length - 1) {
        loadQuestion(currentQIndex + 1);
    }
}

function finishQuiz() {
    document.getElementById('feedback-overlay').classList.remove('active');
    document.getElementById('quiz-interface').classList.add('hidden');
    
    const summaryScreen = document.getElementById('summary-screen');
    summaryScreen.classList.remove('hidden');
    summaryScreen.style.display = 'block'; 
    
    let totalScore = 0;
    quizData.questions.forEach(q => { totalScore += (q.score || 0); });
    
    document.getElementById('final-score').innerText = `${totalScore} / 20`;
    document.getElementById('final-percent').innerText = `${(totalScore/20*100).toFixed(1)}%`;
    document.getElementById('final-time').innerText = formatTime(secondsElapsed);

    // --- GENERATE DETAILED SUMMARY HTML ---
    const list = document.getElementById('summary-details');
    let fullHtml = '';

    quizData.questions.forEach((q, i) => {
        const userAns = userAnswers[q.id] || [];
        const scoreColor = q.score === 1 ? 'var(--success)' : (q.score === 0.5 ? 'var(--warning)' : 'var(--danger)');
        const scoreBadge = q.score === 1 ? '‚úÖ 1 Point' : (q.score === 0.5 ? '‚ö†Ô∏è 0.5 Point' : '‚ùå 0 Point');

        let qBlock = `
        <div class="summary-block">
            <h3>
                <span>Q${i+1}</span>
                <span class="score-tag" style="background:${scoreColor}">${scoreBadge}</span>
            </h3>
            <p style="margin-bottom:1rem; color:var(--text-main); font-weight:600;">${q.text}</p>
            <div>
        `;

        q.items.forEach(item => {
            const isChecked = userAns.includes(item.id);
            let icon = '';
            let color = '';
            
            // Logic for icon: Green Check (Correct choice), Red X (Mistake)
            if (item.correct) {
                if (isChecked) { icon = '‚úÖ'; color = 'var(--success)'; } // True Positive
                else { icon = '‚ö†Ô∏è'; color = 'var(--warning)'; } // False Negative (Forgotten)
            } else {
                if (isChecked) { icon = '‚ùå'; color = 'var(--danger)'; } // False Positive (Error)
                else { icon = '‚úì'; color = 'var(--text-muted)'; } // True Negative (Correctly avoided)
            }

            qBlock += `
            <div class="summary-item-row">
                <div class="summary-item-status">${icon}</div>
                <div class="summary-item-text">
                    <span style="color:${color}; font-weight:bold; margin-right:0.5rem;">${item.id}</span>
                    <span style="color:var(--text-main);">${item.text}</span>
                    ${isChecked ? '<span class="user-action ua-checked">COCH√â</span>' : ''}
                    <div class="summary-item-expl">${item.explication}</div>
                </div>
            </div>`;
        });

        qBlock += `</div></div>`;
        fullHtml += qBlock;
    });

    list.innerHTML = fullHtml;
}

function copyCorrection() {
    let text = `RAPPORT DE CORRECTION - ${quizData.title}\n`;
    text += `Score: ${document.getElementById('final-score').innerText} (${document.getElementById('final-percent').innerText})\n`;
    text += `Temps: ${document.getElementById('final-time').innerText}\n`;
    text += `--------------------------------------------------\n\n`;

    quizData.questions.forEach((q, i) => {
        const userAns = userAnswers[q.id] || [];
        text += `QUESTION ${i+1} : ${q.text}\n`;
        text += `Note : ${q.score || 0}/1 pt\n`;
        
        q.items.forEach(item => {
            const isChecked = userAns.includes(item.id);
            let status = '';
            
            if (item.correct) {
                status = isChecked ? "‚úÖ VRAI (Coch√©)" : "‚ö†Ô∏è VRAI (Oubli√©)";
            } else {
                status = isChecked ? "‚ùå FAUX (Coch√© √† tort)" : "‚úì FAUX (Non coch√©)";
            }

            text += `   [${item.id}] ${status}\n`;
            text += `   ‚Ü≥ ${item.explication}\n`;
        });
        text += `\n--------------------------------------------------\n\n`;
    });

    navigator.clipboard.writeText(text).then(() => {
        const btn = document.querySelector('button[onclick="copyCorrection()"]');
        const originalText = btn.innerText;
        btn.innerText = "‚úÖ Copi√© !";
        setTimeout(() => btn.innerText = originalText, 2000);
    });
}

// --- UTILITIES ---
function flagQuestion() {
    const qId = quizData.questions[currentQIndex].id;
    if (flaggedQuestions.has(qId)) flaggedQuestions.delete(qId);
    else flaggedQuestions.add(qId);
    renderNav(); // Update star
}

function toggleNav() {
    document.getElementById('nav-panel').classList.toggle('open');
}

function renderNav() {
    const grid = document.getElementById('nav-grid');
    grid.innerHTML = quizData.questions.map((q, i) => {
        const isFlagged = flaggedQuestions.has(q.id);
        return `<button class="nav-btn ${i === currentQIndex ? 'current' : ''}" onclick="loadQuestion(${i}); toggleNav();">
            ${isFlagged ? '‚≠ê' : ''} ${i+1}
        </button>`;
    }).join('');
}

function updateNavColor(index, status) {
    const btn = document.getElementById('nav-grid').children[index];
    btn.classList.remove('success', 'warning', 'danger');
    btn.classList.add(status);
}

function updateNavSelection() {
    const btns = document.querySelectorAll('.nav-btn');
    btns.forEach((b, i) => {
        if (i === currentQIndex) b.classList.add('current');
        else b.classList.remove('current');
    });
}

function startTimer() {
    timerInterval = setInterval(() => {
        if (!isTimerPaused) {
            secondsElapsed++;
            document.getElementById('timer').innerText = formatTime(secondsElapsed);
        }
    }, 1000);
}

function pauseTimer() {
    isTimerPaused = true;
    document.getElementById('timer').classList.add('paused');
}

function resumeTimer() {
    isTimerPaused = false;
    document.getElementById('timer').classList.remove('paused');
}

function formatTime(sec) {
    const m = Math.floor(sec / 60).toString().padStart(2, '0');
    const s = (sec % 60).toString().padStart(2, '0');
    return `${m}:${s}`;
}

function toggleTheme() {
    if (document.body.getAttribute('data-theme') === 'light') {
        document.body.removeAttribute('data-theme');
        document.body.setAttribute('data-theme', 'dark');
    } else {
        document.body.setAttribute('data-theme', 'light');
    }
}

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
    if(document.getElementById('quiz-interface').classList.contains('hidden')) return;
    
    if (e.key === 'ArrowRight') { /* Could impl next question if validated */ }
    if (e.key === 'f') flagQuestion();
});

// Start
init();
</script>
</body>
</html>
